<!doctype html>
<html>
<head>
<meta charset=UTF-8>
<title>AI Vision | رؤية الذكاء الاصطناعي</title>
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
<style>.action-btn,.post-info p{font-size:14px}#bottom-nav,.page-overlay{position:fixed;background-color:var(--dark-gray)}#nav-upload-btn,.action-btn,body,html{color:var(--text-color)}#comments-overlay,.page-overlay{width:100%;transition:transform .3s ease-in-out}#uploadProgressBar,.toast{box-shadow:0 4px 12px rgba(0,0,0,.6)}.post-actions,.post-info,.sent{align-self:flex-end}:root{--primary-color:#e91e63;--background-color:#000;--text-color:#fff;--text-color-secondary:#ccc;--dark-gray:#121212;--medium-gray:#1a1a1a;--light-gray:#282828;--font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;--bottom-nav-height:60px}*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}body,html{height:100%;width:100%;overflow:hidden;background-color:var(--background-color);font-family:var(--font-family)}#app-container{height:100vh;width:100%;position:relative}.page-overlay{top:0;left:0;height:100%;z-index:1500;transform:translateX(100%);overflow-y:auto;padding-bottom:var(--bottom-nav-height)}.action-btn,.nav-btn{background:0 0;cursor:pointer}html[dir=rtl] .page-overlay{transform:translateX(-100%)}.page-overlay.active{transform:translateX(0)}.page-content{padding:20px 15px}h2,h3{color:var(--primary-color);margin-bottom:15px}.page-content p{line-height:1.6;color:var(--text-color-secondary);margin-bottom:10px}.action-btn.liked,.nav-btn.active,.page-content a{color:var(--primary-color)}.page-content a{text-decoration:none}#feed{height:100%;overflow-y:scroll;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch;background:var(--background-color)}.post{height:100vh;width:100%;scroll-snap-align:start;position:relative;display:flex;justify-content:center;align-items:center;overflow:hidden}.media-item img,.media-item video,.post img,.post video{width:100%;height:100%;object-fit:contain}#post-ui-overlay{position:fixed;bottom:var(--bottom-nav-height);left:0;right:0;top:0;pointer-events:none;display:flex;justify-content:space-between;padding:15px}.post-info{text-shadow:1px 1px 3px rgba(0,0,0,.7);pointer-events:auto}.post-info h3{margin:0 0 5px;color:#fff;cursor:pointer}.post-actions{display:flex;flex-direction:column;gap:20px;align-items:center}.action-btn{border:none;display:flex;flex-direction:column;align-items:center;gap:5px;text-shadow:1px 1px 3px rgba(0,0,0,.5);pointer-events:auto;transition:transform .2s,color .2s}.action-btn:active{transform:scale(1.1)}.action-btn svg{width:32px;height:32px;fill:currentColor;filter:drop-shadow(0 2px 2px rgba(0,0,0,.5))}.action-btn .avatar-img{width:45px;height:45px;border-radius:50%;border:2px solid var(--text-color);object-fit:cover}.heart-anim{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:100px;color:rgba(255,255,255,.9);opacity:0;animation:.6s pop;pointer-events:none}#notif-badge,.nav-btn{font-size:10px;display:flex}.comment-item strong,.comments-header,.nav-btn{color:var(--text-color-secondary)}@keyframes pop{0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(-50%,-50%) scale(1)}}#bottom-nav{bottom:0;left:0;width:100%;height:var(--bottom-nav-height);border-top:1px solid var(--light-gray);display:flex;justify-content:space-around;align-items:center;z-index:1600}.nav-btn{border:none;flex-direction:column;align-items:center;gap:4px;transition:color .2s;flex:1;height:100%;justify-content:center}.nav-btn svg{width:24px;height:24px;fill:currentColor}#nav-upload-btn div{background-color:var(--primary-color);border-radius:12px;padding:5px 10px;display:flex;align-items:center;justify-content:center}#nav-upload-btn div svg{width:28px;height:28px}.nav-btn-wrapper{position:relative}#notif-badge{position:absolute;top:-5px;right:-8px;background:red;color:#fff;border-radius:50%;width:18px;height:18px;justify-content:center;align-items:center;border:1px solid var(--dark-gray)}#comments-overlay{position:fixed;bottom:0;left:0;height:50%;background:var(--dark-gray);border-top-left-radius:20px;border-top-right-radius:20px;transform:translateY(100%);z-index:1700;display:flex;flex-direction:column;padding:10px}#comments-overlay.show{transform:translateY(0)}.comments-header{text-align:center;padding:5px}.comments-list{flex:1;overflow-y:auto;padding:10px}.comment-item{display:flex;gap:10px;margin-bottom:15px}.comment-item img{width:32px;height:32px;border-radius:50%;object-fit:cover}.comment-item strong{font-size:13px}.add-comment button,.add-comment input,.btn-primary,.btn-secondary,.profile-header h3{color:var(--text-color)}.comment-item p{font-size:15px;margin:0}.add-comment{display:flex;gap:10px;padding-top:10px;border-top:1px solid var(--light-gray)}.add-comment input{flex:1;background:var(--light-gray);border:none;border-radius:20px;padding:10px 15px}.add-comment button,.btn{border:none;cursor:pointer}.add-comment button{background:var(--primary-color);border-radius:50%;width:40px;height:40px;flex-shrink:0}.modal,.modal-buttons{justify-content:center}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;z-index:2000;padding:15px}#search-page input,.modal-content,.notification-list .item{background:var(--medium-gray)}.modal.show{display:flex}.modal-content{padding:20px;border-radius:12px;text-align:center;width:100%;max-width:400px}#progressBarFill,.btn-primary{background:var(--primary-color)}.modal-content input,.modal-content select,.modal-content textarea{width:100%;padding:10px;margin-top:10px;border-radius:8px;border:1px solid var(--light-gray);background:var(--dark-gray);color:var(--text-color)}.modal-buttons{display:flex;gap:8px;margin-top:20px}.btn{padding:10px 20px;border-radius:20px;font-weight:700}.btn-secondary{background:var(--light-gray)}.social-login{display:flex;justify-content:center;gap:10px;margin-top:15px}.social-login button{border:none;border-radius:6px;cursor:pointer;padding:8px 12px;display:flex;align-items:center;gap:5px}.google-btn{background:#fff;color:#000}.media-item,.notification-list .item:hover,.toast{background:var(--light-gray)}.small-icon{width:18px;height:18px}.profile-header{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:20px}.profile-header img{width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px solid var(--primary-color)}.profile-header h3{margin:5px 0 0}.profile-header p{color:var(--text-color-secondary);font-size:14px;margin:0}.profile-actions{display:flex;gap:10px;margin-top:10px}.media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:5px}.media-item{position:relative;border-radius:8px;overflow:hidden;cursor:pointer;aspect-ratio:1/1}.media-actions{position:absolute;top:5px;right:5px;display:flex;gap:5px}#uploadProgressBar,.toast-container{position:fixed;top:20px;left:50%;transform:translateX(-50%)}.media-actions button{background:rgba(0,0,0,.6);border:none;color:#fff;padding:5px;border-radius:50%;cursor:pointer;font-size:12px;line-height:1;display:flex;align-items:center;justify-content:center;width:24px;height:24px}#search-page input{width:100%;padding:12px 15px;font-size:16px;border-radius:25px;border:none;outline:0;color:#fff;margin-bottom:15px}.notification-list .item{padding:15px;border-radius:8px;margin-bottom:10px;cursor:pointer;transition:background .2s}.toast-container{z-index:3000;display:flex;flex-direction:column;gap:10px;align-items:center}.toast{padding:10px 16px;border-radius:20px;color:#fff;font-size:14px}#uploadProgressBar{display:none;width:80%;max-width:400px;background:#333;border-radius:8px;z-index:3001;padding:10px}#progressMessage{color:#fff;text-align:center;margin-bottom:8px;font-size:14px}#progressBarFill{width:0%;height:10px;border-radius:5px;transition:width .3s}#chatMessages{display:flex;flex-direction:column;gap:8px;padding:10px}.chat-message{padding:8px 12px;border-radius:18px;max-width:75%;word-wrap:break-word}.sent{background-color:var(--primary-color);color:#fff}.received,html[dir=rtl] .sent{align-self:flex-start}.received{background-color:var(--light-gray);color:#fff}html[dir=rtl] .received{align-self:flex-end}.hidden{display:none!important}</style>
<link rel=stylesheet href=/index.css>
<script type=importmap>
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.23.0"
  }
}
</script>
</head>
<body>
<div id=root></div>
<main id=app-container>
<div id=feed></div>
<div id=post-ui-overlay>
<div class=post-info>
<h3 id=ui-post-author>@username</h3>
<p id=ui-post-title>Post Title</p>
</div>
<div class=post-actions>
<button class=action-btn id=ui-avatar-btn><img src=https://img.icons8.com/ios/100/user.png class=avatar-img></button>
<button class=action-btn id=ui-like-btn>
<svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg>
<span id=ui-like-count>0</span>
</button>
<button class=action-btn id=ui-comment-btn>
<svg viewBox="0 0 24 24"><path d="M20 2 H4 c -1.1 0 -2 .9 -2 2 v 18 l 4 -4 h 14 c 1.1 0 2 -.9 2 -2 V 4 c 0 -1.1 -0.9 -2 -2 -2 z"></path></svg>
<span id=ui-comment-count>0</span>
</button>
</div>
</div>
</main>
<section id=search-page class=page-overlay>
<div class=page-content>
<input id=searchInput data-translate-placeholder=search_placeholder>
<div id=searchResults class=media-grid></div>
</div>
</section>
<section id=notifications-page class=page-overlay>
<div class=page-content>
<h2 data-translate-key=notifications>Notifications</h2>
<div id=notificationList class=notification-list></div>
</div>
</section>
<section id=profile-page class=page-overlay>
<div class=page-content>
<div class=profile-header>
<img id=profileAvatar src=https://img.icons8.com/ios/100/user.png alt=avatar>
<h3 id=profileName>Username</h3>
<p id=profileEmail>email@example.com</p>
<p id=profileBio>Bio goes here...</p>
<div id=my-profile-actions class=profile-actions>
<button class="btn btn-secondary" id=edit-profile-btn data-translate-key=edit_profile>Edit Profile</button>
<button class="btn btn-secondary" id=logout-btn data-translate-key=logout>Logout</button>
<button id=privacy-policy-btn class="btn btn-secondary" data-translate-key=privacy_policy>Privacy Policy</button>
</div>
<div id=user-profile-actions class=profile-actions>
<button id=followBtn class="btn btn-primary" data-translate-key=follow>Follow</button>
<button id=messageBtn class="btn btn-secondary" data-translate-key=message>Message</button>
</div>
</div>
<h3><span data-translate-key=media>Media</span></h3>
<div id=profileMediaGrid class=media-grid></div>
</div>
</section>
<section id=privacy-page class=page-overlay>
<div class=page-content>
<h2 data-translate-key=privacy_policy>Privacy Policy</h2>
<p data-translate-key=privacy_p1>This policy describes how we collect, use, and handle your information when you use our application.</p>
<h3 data-translate-key=privacy_h_collect>Data Collection and Use</h3>
<p data-translate-key=privacy_p2>When you create an account, we collect your email. You may optionally provide a display name, profile picture, and bio. We also collect content you create, like photos, videos, comments, and likes, to provide and personalize the service.</p>
<h3 data-translate-key=privacy_h_contact>Contact Us</h3>
<p data-translate-key=privacy_p3>For any questions about this Privacy Policy, you can contact the developer:</p>
<p><strong><span data-translate-key=developer_name>Name</span>:</strong> MOHAMED ERRAQQAD</p>
<p><strong><span data-translate-key=developer_email>Email</span>:</strong> <a href="mailto:assylerr2021@gmail.com">dev@example.com</a></p>
<p><a href=https://privacy-policyap.blogspot.com/2025/10/ruyax.html?m=1 target=_blank data-translate-key=privacy_full_link>View Full Privacy Policy</a></p>
</div>
</section>
<nav id=bottom-nav>
<button class="nav-btn active" data-page=home-page>
<svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
<span data-translate-key=home>Home</span>
</button>
<button class=nav-btn data-page=search-page>
<svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
<span data-translate-key=search>Search</span>
</button>
<button id=nav-upload-btn class=nav-btn>
<div><svg viewBox="0 0 24 24" fill=currentColor><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>
</button>
<button class=nav-btn data-page=notifications-page>
<div class=nav-btn-wrapper>
<svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
<div id=notif-badge class=hidden>0</div>
</div>
<span data-translate-key=notifications>Notifications</span>
</button>
<button class=nav-btn data-page=profile-page>
<svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
<span data-translate-key=profile>Profile</span>
</button>
</nav>
<div id=comments-overlay>
<h4 class=comments-header data-translate-key=comments>Comments</h4>
<div id=comments-list class=comments-list></div>
<div class=add-comment>
<input id=comment-input data-translate-placeholder=add_comment_placeholder>
<button id=send-comment-btn>➤</button>
</div>
</div>
<div class=modal id=loginModal>
<div class=modal-content>
<h2 data-translate-key=login_title>Login / Sign Up</h2>
<input id=email type=email data-translate-placeholder=email>
<input id=password type=password data-translate-placeholder=password>
<div class=modal-buttons>
<button id=login-btn class="btn btn-primary" data-translate-key=login>Login</button>
<button id=signup-btn class="btn btn-primary" data-translate-key=signup>Sign Up</button>
<button data-modal-close=loginModal class="btn btn-secondary" data-translate-key=cancel>Cancel</button>
</div>
<div class=social-login>
<button class=google-btn id=google-login-btn><img class=small-icon src=https://img.icons8.com/color/48/000000/google-logo.png> Google</button>
</div>
</div>
</div>
<div class=modal id=uploadModal>
<div class=modal-content>
<h2 id=uploadModalTitle data-translate-key=upload_media>Upload Media</h2>
<input id=title data-translate-placeholder=title>
<textarea id=desc data-translate-placeholder=description></textarea>
<select id=type><option value=video data-translate-key=video>Video</option><option value=image data-translate-key=image>Image</option></select>
<input type=file id=mediaFileInput accept=image/*,video/* style=margin-top:10px>
<div id=thumbnail-preview-container class=hidden style=margin-top:15px>
<p style=color:var(--text-color-secondary);margin-bottom:8px;font-size:14px>Thumbnail Preview:</p>
<img id=thumbnailPreviewImage src="" alt="Video thumbnail preview" style="max-width:100%;max-height:200px;border-radius:8px;margin:0 auto;display:block;border:1px solid var(--light-gray)">
</div>
<div class=modal-buttons>
<button id=save-upload-btn class="btn btn-primary" data-translate-key=save>Save</button>
<button data-modal-close=uploadModal class="btn btn-secondary" data-translate-key=cancel>Cancel</button>
</div>
</div>
</div>
<div class=modal id=editProfileModal>
<div class=modal-content>
<h3 data-translate-key=edit_profile>Edit Profile</h3>
<label for=newAvatarFile style=cursor:pointer;display:block;margin-top:10px>
<img id=avatarPreview src=https://img.icons8.com/ios/100/user.png alt="avatar preview" style=width:90px;height:90px;border-radius:50%;object-fit:cover;margin-bottom:10px>
<div data-translate-key=change_avatar class="btn btn-secondary" style="margin:0 auto 10px;width:fit-content">Change Avatar</div>
</label>
<input type=file id=newAvatarFile accept=image/* style=display:none>
<input id=newDisplayName data-translate-placeholder=display_name>
<textarea id=newBio data-translate-placeholder=bio></textarea>
<div class=modal-buttons>
<button id=saveProfileBtn class="btn btn-primary" data-translate-key=save>Save</button>
<button data-modal-close=editProfileModal class="btn btn-secondary" data-translate-key=cancel>Cancel</button>
</div>
</div>
</div>
<div class=modal id=privateChatModal>
<div class=modal-content style=height:70%;display:flex;flex-direction:column>
<h3 id=chatWith>Chat</h3>
<div id=chatMessages class=comments-list></div>
<div class=add-comment>
<input id=chatInput data-translate-placeholder=type_message>
<button id=sendChatBtn>➤</button>
</div>
<div class=modal-buttons>
<button data-modal-close=privateChatModal class="btn btn-secondary" data-translate-key=close>Close</button>
</div>
</div>
</div>
<div class=modal id=deleteToast>
<div class=modal-content>
<p data-translate-key=delete_confirm>Are you sure you want to delete?</p>
<div class=modal-buttons>
<button id=confirmDelete class="btn btn-primary" style=background:#e74c3c data-translate-key=yes>Yes</button>
<button id=cancelDelete class="btn btn-secondary" data-translate-key=no>No</button>
</div>
</div>
</div>
<div class=toast-container id=toastContainer></div>
<div id=uploadProgressBar><p id=progressMessage></p><div id=progressBarFill></div></div>
<script src=https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js></script>
<script type=module>document.addEventListener("DOMContentLoaded",(()=>{firebase.initializeApp({apiKey:"AIzaSyDRBLmKK4a0hcliz30X3DextgfMJHLJEpQ",authDomain:"ai-galry.firebaseapp.com",databaseURL:"https://ai-galry-default-rtdb.firebaseio.com/",projectId:"ai-galry",storageBucket:"ai-galry.appspot.com",messagingSenderId:"938786984748",appId:"1:938786984748:web:b2a3bc29ccc321e3349289"});let e,t=firebase.database(),a=firebase.auth(),i=new firebase.auth.GoogleAuthProvider,o={user:null,currentVisiblePostKey:null,feedQueue:[],seenKeys:new Set,lastTimestampCursor:null,isLoadingFeed:!1,currentChat:{},deleteKey:null,currentPostListeners:[],activeListeners:{},isAppMuted:!0},l={},s=null,n=null,r={ar:{home:"الرئيسية",search:"بحث",notifications:"الإشعارات",profile:"ملفي",search_placeholder:"🔍 ابحث عن منشورات...",edit_profile:"تعديل الملف الشخصي",logout:"تسجيل الخروج",follow:"متابعة",message:"مراسلة",media:"الوسائط",privacy_policy:"سياسة الخصوصية",comments:"التعليقات",add_comment_placeholder:"أضف تعليقًا...",login_title:"تسجيل الدخول / إنشاء حساب",email:"البريد الإلكتروني",password:"كلمة المرور",login:"دخول",signup:"حساب جديد",cancel:"إلغاء",upload_media:"رفع وسائط",title:"العنوان",description:"الوصف",video:"فيديو",image:"صورة",save:"حفظ",display_name:"اسم العرض",bio:"السيرة الذاتية",type_message:"اكتب رسالة...",close:"إغلاق",delete_confirm:"هل أنت متأكد أنك تريد الحذف؟",yes:"نعم",no:"لا",privacy_p1:"تصف هذه السياسة كيفية جمع معلوماتك واستخدامها والتعامل معها عند استخدام تطبيقنا.",privacy_h_collect:"جمع البيانات واستخدامها",privacy_p2:"عندما تنشئ حسابًا، نجمع بريدك الإلكتروني. يمكنك اختياريًا تقديم اسم عرض وصورة ملف شخصي وسيرة ذاتية. نجمع أيضًا المحتوى الذي تنشئه، مثل الصور ومقاطع الفيديو والتعليقات والإعجابات، لتقديم الخدمة وتخصيصها.",privacy_h_contact:"التواصل معنا",privacy_p3:"لأية أسئلة حول سياسة الخصوصية هذه، يمكنك التواصل مع المطور:",developer_name:"الاسم",developer_email:"البريد الإلكتروني",privacy_full_link:"عرض سياسة الخصوصية الكاملة",reloading_feed:"إعادة تحميل المنشورات...",no_posts_yet:"لا توجد منشورات بعد.",post_unavailable:"المنشور غير متاح حاليا.",loading_post:"جاري عرض المنشور...",file_required:"الرجاء اختيار ملف",upload_failed:"فشل الرفع: ",saving_data:"جاري حفظ البيانات...",upload_success:"تم الرفع بنجاح! سيتم مراجعته.",profile_updated:"تم تحديث الملف الشخصي",deleted_successfully:"تم الحذف",logged_out:"تم تسجيل الخروج",no_comments_yet:"لا توجد تعليقات بعد.",loading:"جاري التحميل...",no_media:"لا توجد وسائط.",no_notifications:"لا توجد إشعارات جديدة.",unfollow:"إلغاء المتابعة",chat_with:"محادثة مع",unknown_user:"مستخدم",like_notification:"قام {user} بالإعجاب بمنشورك",comment_notification:"قام {user} بالتعليق على منشورك",follow_notification:"بدأ {user} بمتابعتك",chat_notification:"رسالة جديدة من {user}",edit_media:"تعديل الوسائط",delete:"حذف",load_media:"تحميل الوسائط",change_avatar:"تغيير الصورة الرمزية",resizing_image:"جاري تغيير حجم الصورة...",uploading_image:"جاري رفع الصورة...",generating_thumbnail:"جاري إنشاء الصورة المصغرة...",uploading_files:"جاري رفع الملفات...",audio_on:"تم تشغيل الصوت"},en:{home:"Home",search:"Search",notifications:"Notifications",profile:"Profile",search_placeholder:"🔍 Search for posts...",edit_profile:"Edit Profile",logout:"Logout",follow:"Follow",message:"Message",media:"Media",privacy_policy:"Privacy Policy",comments:"Comments",add_comment_placeholder:"Add a comment...",login_title:"Login / Sign Up",email:"Email",password:"Password",login:"Login",signup:"Sign Up",cancel:"Cancel",upload_media:"Upload Media",title:"Title",description:"Description",video:"Video",image:"Image",save:"Save",display_name:"Display Name",bio:"Bio",type_message:"Type a message...",close:"Close",delete_confirm:"Are you sure you want to delete?",yes:"Yes",no:"No",privacy_p1:"This policy describes how we collect, use, and handle your information when you use our application.",privacy_h_collect:"Data Collection and Use",privacy_p2:"When you create an account, we collect your email. You may optionally provide a display name, profile picture, and bio. We also collect content you create, like photos, videos, comments, and likes, to provide and personalize the service.",privacy_h_contact:"Contact Us",privacy_p3:"For any questions about this Privacy Policy, you can contact the developer:",developer_name:"Name",developer_email:"Email",privacy_full_link:"View Full Privacy Policy",reloading_feed:"Reloading feed...",no_posts_yet:"No posts yet.",post_unavailable:"Post is currently unavailable.",loading_post:"Loading post...",file_required:"Please select a file",upload_failed:"Upload failed: ",saving_data:"Saving data...",upload_success:"Uploaded successfully! Pending review.",profile_updated:"Profile updated successfully",deleted_successfully:"Deleted successfully",logged_out:"Logged out",no_comments_yet:"No comments yet.",loading:"Loading...",no_media:"No media found.",no_notifications:"No new notifications.",unfollow:"Unfollow",chat_with:"Chat with",unknown_user:"user",like_notification:"{user} liked your post",comment_notification:"{user} commented on your post",follow_notification:"{user} started following you",chat_notification:"New message from {user}",edit_media:"Edit Media",delete:"Delete",load_media:"Load Media",change_avatar:"Change Avatar",resizing_image:"Resizing image...",uploading_image:"Uploading image...",generating_thumbnail:"Generating thumbnail...",uploading_files:"Uploading files...",audio_on:"Audio On"}},d="en",c=(e,t={})=>{let a=r[d]?.[e]||r.en[e]||e;for(let e in t)a=a.replace(`{${e}}`,t[e]);return a},u=e=>document.getElementById(e),p=(e,t="q_auto:eco,f_auto,w_auto,c_limit")=>e?e.replace(/upload\//,`upload/${t}/`):"",m=(e,t={},a=3e3)=>{let i=document.createElement("div");i.className="toast",i.innerText=c(e,t),u("toastContainer").appendChild(i),setTimeout((()=>i.remove()),a)},f=(e,t="",a=0)=>{u("uploadProgressBar").style.display=e?"block":"none",e&&(u("progressMessage").innerText=c(t),u("progressBarFill").style.width=`${a}%`)},h=e=>u(e)?.classList.add("show"),g=e=>u(e)?.classList.remove("show"),v=(e,t)=>{let a=null;return(...i)=>{clearTimeout(a),a=setTimeout((()=>e(...i)),t)}},y=async e=>{let a=l[e];if(a&&Date.now()-a.timestamp<3e5)return a.data;try{let a=(await t.ref("users/"+e).once("value")).val()||{uid:e,displayName:c("unknown_user"),photoURL:""};return l[e]={data:a,timestamp:Date.now()},a}catch(t){return console.error(`Error fetching user data for ${e}:`,t),{uid:e,displayName:c("unknown_user"),photoURL:""}}},_=e=>{if(document.querySelectorAll(".page-overlay").forEach((e=>e.classList.remove("active"))),"home-page"!==e)u(e)?.classList.add("active"),s&&!s.paused&&s.pause();else{let e=u(`post-${o.currentVisiblePostKey}`);if(e){let t=e.querySelector("video");t&&t.paused&&(t.play().catch((()=>{})),s=t)}}document.querySelectorAll(".nav-btn").forEach((t=>{t.classList.toggle("active",t.dataset.page===e)})),"notifications-page"===e&&o.user&&function(){if(!o.user)return;H();let e=u("notificationList");e.innerHTML="";let a=t.ref("notifications").orderByChild("to").equalTo(o.user.uid).limitToLast(50),i=t=>{let a=e.querySelector("p");a&&a.remove();let i={...t.val(),key:t.key};if(u(`notif-${i.key}`))return;let o=document.createElement("div");o.className="item",o.id=`notif-${i.key}`;let l,s=i.from||c("unknown_user");l="like"===i.type?c("like_notification",{user:s}):"comment"===i.type?c("comment_notification",{user:s}):"follow"===i.type?c("follow_notification",{user:s}):c("chat_notification",{user:s}),o.textContent=l,o.onclick=()=>q(i),e.prepend(o),R(e.children.length)},l=t=>{let a=t.key,i=u(`notif-${a}`);i&&i.remove();let o=e.children.length;R(o),0===o&&(e.innerHTML=`<p>${c("no_notifications")}</p>`)};A.added={ref:a,callback:a.on("child_added",i)},A.removed={ref:a,callback:a.on("child_removed",l)},a.once("value",(t=>{t.exists()||(e.innerHTML=`<p>${c("no_notifications")}</p>`,R(0))}))}()},b=async(e,t={})=>{let a=new FormData;a.append("file",e),a.append("upload_preset","My First App"),Object.keys(t).forEach((e=>{a.append(e,t[e])}));try{let e=await fetch("https://api.cloudinary.com/v1_1/df4fjnby3/upload",{method:"POST",body:a}),t=await e.json();if(!e.ok)throw Error(t.error?.message||"Cloudinary upload failed with unknown error.");return t.secure_url}catch(e){throw console.error("Error in uploadToCloudinary:",e),e}},L=v((e=>{if(!e)return;t.ref(`products/${e}/views`).set(firebase.database.ServerValue.increment(1))}),1e3),w=async()=>{if(o.isLoadingFeed)return;o.isLoadingFeed=!0;let e=t.ref("products").orderByChild("timestamp").limitToLast(30);o.lastTimestampCursor&&(e=e.endAt(o.lastTimestampCursor));let a=await e.once("value");if(!a.exists()||o.lastTimestampCursor&&1>=a.numChildren())return o.seenKeys.clear(),o.lastTimestampCursor=null,o.isLoadingFeed=!1,void(0===o.feedQueue.length&&w());let i=[];if(a.forEach((e=>{let t=e.val();"approved"===t.status&&i.push({key:e.key,timestamp:t.timestamp})})),o.lastTimestampCursor&&i.length>0&&i.shift(),0===i.length)return void(o.isLoadingFeed=!1);o.lastTimestampCursor=i[0].timestamp;let l=i.map((e=>e.key)).filter((e=>!o.seenKeys.has(e)));l.forEach((e=>o.seenKeys.add(e)));let s=l.sort((()=>Math.random()-.5));o.feedQueue.push(...s),o.isLoadingFeed=!1},k=async()=>{o.feedQueue.length<5&&await w();let a=o.feedQueue.shift();if(!a){let e=u("feed");return void(0===e.children.length&&(e.innerHTML=`<div class="post" style="display:flex; align-items:center; justify-content:center; text-align:center;"><p>${c("no_posts_yet")}</p></div>`))}let i=await t.ref(`products/${a}`).once("value");if(i.exists()){let t=((e,t)=>{let a=document.createElement("div");return a.className="post",a.id=`post-${t}`,a.dataset.key=t,a.ondblclick=()=>T(o.currentVisiblePostKey),"video"===e.type?(a.classList.add("video-placeholder"),a.dataset.videoSrc=p(e.mediaUrl),a.dataset.posterSrc=p(e.thumb,"q_auto:good"),a.innerHTML=`<img src="${p(e.thumb,"q_auto:good")}" loading="lazy" alt="${e.title||""}">`):a.innerHTML=`<img src="${p(e.mediaUrl)}" loading="lazy" alt="${e.title||""}">`,a})(i.val(),i.key),a=u("feed");a.querySelector("p")&&(a.innerHTML=""),a.appendChild(t),e.observe(t)}},E=e=>{if(!e||!e.dataset.key)return;let t=e.previousElementSibling?.previousElementSibling;if(t&&!t.classList.contains("video-placeholder")&&t.dataset.videoSrc){let e=t.querySelector("video");e&&(e.pause(),e.src="",t.innerHTML=`<img src="${t.dataset.posterSrc}" loading="lazy" alt="">`,t.classList.add("video-placeholder"))}let a=e.nextElementSibling?.nextElementSibling;if(a&&!a.classList.contains("video-placeholder")&&a.dataset.videoSrc){let e=a.querySelector("video");e&&(e.pause(),e.src="",a.innerHTML=`<img src="${a.dataset.posterSrc}" loading="lazy" alt="">`,a.classList.add("video-placeholder"))}if(s&&s.parentElement!==e&&s.pause(),e.classList.contains("video-placeholder")&&e.dataset.videoSrc){let t=document.createElement("video");t.src=e.dataset.videoSrc,t.poster=e.dataset.posterSrc,t.playsinline=!0,t.muted=o.isAppMuted,t.loop=!0,e.innerHTML="",e.appendChild(t),t.play().catch((()=>{})),e.classList.remove("video-placeholder"),s=t}else{let t=e.querySelector("video");t&&(t.muted=o.isAppMuted,t.play().catch((()=>{})),s=t)}let i=e.nextElementSibling;if(i&&i.classList.contains("video-placeholder")&&i.dataset.videoSrc){let e=document.createElement("video");e.src=i.dataset.videoSrc,e.poster=i.dataset.posterSrc,e.playsinline=!0,e.muted=o.isAppMuted,e.loop=!0,e.preload="auto",i.innerHTML="",i.appendChild(e),i.classList.remove("video-placeholder")}},$=async(t=null)=>{u("feed").innerHTML=`<div class="post" style="display:flex; align-items:center; justify-content:center; text-align:center;"><p>${c("loading")}</p></div>`,M(),e&&e.disconnect(),o.feedQueue=[],o.seenKeys=new Set,o.lastTimestampCursor=null,o.isLoadingFeed=!1,t&&(o.feedQueue.push(t),o.seenKeys.add(t)),(()=>{e&&e.disconnect();let t={root:u("feed"),threshold:.7};e=new IntersectionObserver((async e=>{for(let t of e)if(t.isIntersecting){let e=t.target;E(e);let a=e.dataset.key;a!==o.currentVisiblePostKey&&(o.currentVisiblePostKey=a,C(a),L(a)),null===e.nextElementSibling?.nextElementSibling&&await k()}}),t)})(),await k(),await k(),await k()},M=()=>{o.currentPostListeners.forEach((({ref:e,event:t,callback:a})=>e.off(t,a))),o.currentPostListeners=[]},C=async e=>{if(M(),!e)return;let a=await t.ref(`products/${e}`).once("value");if(!a.exists())return;let i=a.val(),l=await y(i.uid);u("ui-post-author").textContent=`@${l.displayName||c("unknown_user")}`;let s=l.photoURL||"https://img.icons8.com/ios/100/user.png";u("ui-avatar-btn").querySelector("img").src=s,u("ui-post-title").textContent=i.title||"",u("ui-avatar-btn").onclick=()=>P(i.uid),u("ui-post-author").onclick=()=>P(i.uid),u("ui-like-btn").onclick=()=>T(e),u("ui-comment-btn").onclick=()=>S(e);let n=t.ref(`products/${e}`),r=n.child("likes").on("value",(e=>{u("ui-like-count").textContent=(e.val()||0).toString()}));o.currentPostListeners.push({ref:n.child("likes"),event:"value",callback:r});let d=n.child("comments").on("value",(e=>{u("ui-comment-count").textContent=e.exists()?e.numChildren().toString():"0"}));if(o.currentPostListeners.push({ref:n.child("comments"),event:"value",callback:d}),o.user){let a=t.ref(`likes/${e}/${o.user.uid}`),i=a.on("value",(e=>{u("ui-like-btn").classList.toggle("liked",e.exists())}));o.currentPostListeners.push({ref:a,event:"value",callback:i})}else u("ui-like-btn").classList.remove("liked")},T=e=>{if(!o.user)return h("loginModal");if(!e)return;let a=o.user.uid,i=t.ref(`likes/${e}/${a}`);t.ref(`products/${e}`).once("value",(l=>{let s=l.val();s&&i.once("value",(i=>{let l={},n=i.exists()?-1:1;if(i.exists())l[`/likes/${e}/${a}`]=null;else{let i=u(`post-${e}`);if(i){let e=document.createElement("div");e.className="heart-anim",e.textContent="❤️",i.appendChild(e),setTimeout((()=>e.remove()),600)}if(l[`/likes/${e}/${a}`]=!0,s.uid!==a){l[`/notifications/${t.ref("notifications").push().key}`]={from:o.user.displayName||o.user.email,fromId:a,to:s.uid,type:"like",postId:e,ts:firebase.database.ServerValue.TIMESTAMP}}}l[`/products/${e}/likes`]=firebase.database.ServerValue.increment(n),l[`/products/${e}/engagementScore`]=firebase.database.ServerValue.increment(n),t.ref().update(l)}))}))},S=e=>{let t=u("comments-overlay"),a=!t.classList.contains("show");e&&(t.dataset.key=e),t.classList.toggle("show",a);let i=`products/${t.dataset.key}/comments`;a&&t.dataset.key?x(i):!a&&o.activeListeners[i]&&(o.activeListeners[i].ref.off("child_added",o.activeListeners[i].callback),delete o.activeListeners[i])},x=e=>{let a=u("comments-list");a.innerHTML=`<p style='text-align:center;'>${c("loading")}</p>`;let i=t.ref(e);i.once("value",(e=>{e.exists()||(a.innerHTML=`<p style='text-align:center;'>${c("no_comments_yet")}</p>`)}));let l=i.orderByChild("ts").on("child_added",(async e=>{a.querySelector("p")&&(a.innerHTML="");let t=e.val(),i=document.createElement("div");i.className="comment-item";let o=await y(t.user),l=o.photoURL||"https://img.icons8.com/ios/50/user.png";i.innerHTML=`<img src="${l}" alt="">\n                <div><strong>${o.displayName||c("unknown_user")}</strong><p>${t.text}</p></div>`,a.prepend(i)}));o.activeListeners[e]={ref:i,callback:l}},P=async e=>{_("profile-page");let t=o.user&&o.user.uid===e;u("my-profile-actions").style.display=t?"flex":"none",u("user-profile-actions").style.display=t?"none":"flex";let a=await y(e),i=a.photoURL||"https://img.icons8.com/ios/100/user.png";u("profileAvatar").src=i,u("profileName").textContent=a.displayName||c("unknown_user"),u("profileEmail").textContent=a.email||"",u("profileBio").textContent=a.bio||"";let l=u("profileMediaGrid");l.innerHTML="";let s=document.createElement("button");s.textContent=c("load_media"),s.className="btn btn-primary",s.style.margin="20px auto",s.style.display="block",s.onclick=()=>{s.remove(),U(e,t)},l.appendChild(s),t||(o.user?(F(e),u("messageBtn").onclick=()=>K(e)):(u("followBtn").onclick=()=>h("loginModal"),u("messageBtn").onclick=()=>h("loginModal")))},I=e=>{_("home-page"),$(e),m("loading_post")},U=(e,a)=>{let i=u("profileMediaGrid");i.innerHTML=`<p>${c("loading")}</p>`,t.ref("products").orderByChild("uid").equalTo(e).once("value",(e=>{if(i.innerHTML="",!e.exists())return void(i.innerHTML=`<p>${c("no_media")}</p>`);let t=[];if(e.forEach((e=>{let a=e.val();"approved"===a.status&&t.push({key:e.key,...a})})),0===t.length)return void(i.innerHTML=`<p>${c("no_media")}</p>`);let o=document.createDocumentFragment();t.sort(((e,t)=>t.timestamp-e.timestamp)).forEach((e=>{let t=document.createElement("div");t.className="media-item",t.dataset.key=e.key,t.innerHTML=`<img src="${p(e.thumb,"q_auto:good,f_auto,w_400,c_fill,ar_1:1")}" loading="lazy" alt="${e.title||""}">\n                    ${a?`<div class="media-actions">\n                        <button data-action="edit" title="${c("edit_media")}">✏️</button>\n                        <button data-action="delete" title="${c("delete")}">🗑️</button>\n                    </div>`:""}`,o.appendChild(t)})),i.appendChild(o)})).catch((e=>{console.error("Error loading profile media:",e),i.innerHTML="<p>Error loading media.</p>"}))},N=(e=null,t={})=>{if(!o.user)return h("loginModal");u("uploadModal").dataset.editKey=e||"",u("uploadModalTitle").textContent=c(e?"edit_media":"upload_media"),u("title").value=t.title||"",u("desc").value=t.desc||"",t.type&&(u("type").value=t.type),u("mediaFileInput").value="",n=null,u("thumbnail-preview-container").classList.add("hidden"),u("thumbnailPreviewImage").src="",h("uploadModal")},A={};function H(){A.added&&A.added.ref.off("child_added",A.added.callback),A.removed&&A.removed.ref.off("child_removed",A.removed.callback),A={}}function R(e){let t=u("notif-badge");t.textContent=e.toString(),t.classList.toggle("hidden",0===e)}function q(e){e.postId?I(e.postId):"chat"===e.type&&e.fromId?K(e.fromId):e.fromId&&P(e.fromId),t.ref("notifications/"+e.key).remove()}let B=v((async()=>{let e=u("searchInput").value.toLowerCase(),a=u("searchResults");if(a.innerHTML="",e.length<2)return;let i=await t.ref("products").orderByChild("timestamp").limitToLast(200).once("value");if(!i.exists())return;let o=document.createDocumentFragment(),l=[];i.forEach((t=>{let a=t.val();if("approved"===a.status&&(a.title.toLowerCase().includes(e)||a.desc.toLowerCase().includes(e))){let e=document.createElement("div");e.className="media-item",e.innerHTML=`<img src="${p(a.thumb,"q_auto:good,f_auto,w_400,c_fill")}" loading="lazy" alt="${a.title||""}">`,e.onclick=()=>I(t.key),l.push(e)}})),l.reverse().forEach((e=>o.appendChild(e))),a.appendChild(o)}),500),F=e=>{let a=u("followBtn"),i=t.ref(`follows/${o.user.uid}/${e}`);o.activeListeners.follow&&o.activeListeners.follow.ref.off("value",o.activeListeners.follow.callback);let l=e=>{a.textContent=e.exists()?c("unfollow"):c("follow")};i.on("value",l),o.activeListeners.follow={ref:i,callback:l},a.onclick=()=>{i.once("value",(a=>{let i={};if(a.exists())i[`/follows/${o.user.uid}/${e}`]=null,i[`/followers/${e}/${o.user.uid}`]=null;else{i[`/follows/${o.user.uid}/${e}`]=!0,i[`/followers/${e}/${o.user.uid}`]=!0;let a=t.ref("notifications").push().key,l={from:o.user.displayName||o.user.email,fromId:o.user.uid,to:e,type:"follow",ts:firebase.database.ServerValue.TIMESTAMP};i[`/notifications/${a}`]=l}t.ref().update(i)}))}},K=async e=>{let a=o.user.uid;o.currentChat.chatId=a<e?`${a}_${e}`:`${e}_${a}`,o.currentChat.otherUid=e;let i=await y(e);u("chatWith").textContent=`${c("chat_with")} @${i?.displayName||c("unknown_user")}`;let l=u("chatMessages");l.innerHTML="";let s=`privateChats/${o.currentChat.chatId}/messages`;o.activeListeners.chat&&o.activeListeners.chat.ref.off("child_added",o.activeListeners.chat.callback);let n=t.ref(s),r=e=>{let t=e.val(),i=document.createElement("div");i.classList.add("chat-message"),i.classList.toggle("sent",t.from===a),i.classList.toggle("received",t.from!==a),i.textContent=t.text,l.appendChild(i),l.scrollTop=l.scrollHeight};n.orderByChild("ts").on("child_added",r),o.activeListeners.chat={ref:n,callback:r},h("privateChatModal")},D=e=>{if(M(),Object.values(o.activeListeners).forEach((({ref:e,callback:t,event:a})=>e.off(a||"value",t))),o.activeListeners={},H(),o.user=e,o.user){t.ref("notifications").orderByChild("to").equalTo(o.user.uid).on("value",(e=>R(e.numChildren())))}else u("notif-badge").classList.add("hidden"),_("home-page");$()},V=async()=>{if(!o.user)return;g("editProfileModal"),f(!0,"saving_data",10);let e=u("newAvatarFile").files?.[0],a={displayName:u("newDisplayName").value.trim(),bio:u("newBio").value.trim()};if(e)try{f(!0,"resizing_image",30);let t=await((e,t,a)=>new Promise(((i,o)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=l=>{let s=new Image;s.src=l.target.result,s.onload=()=>{if(s.width<=t&&s.height<=a)return i(e);let o=document.createElement("canvas"),{width:l,height:n}=s;l>n?l>t&&(n=Math.round(n*(t/l)),l=t):n>a&&(l=Math.round(l*(a/n)),n=a),o.width=l,o.height=n,o.getContext("2d").drawImage(s,0,0,l,n),o.toBlob(i,"image/png",.9)},s.onerror=o},l.onerror=o})))(e,512,512);f(!0,"uploading_image",50);let i={folder:"avatars",public_id:`${o.user.uid}_${Date.now()}`};a.photoURL=await b(t,i)}catch(e){return m("upload_failed",{message:e.message}),void f(!1)}f(!0,"saving_data",90),await t.ref("users/"+o.user.uid).update(a);let i={};a.displayName&&(i.displayName=a.displayName),a.photoURL&&(i.photoURL=a.photoURL),Object.keys(i).length>0&&await o.user.updateProfile(i),delete l[o.user.uid],f(!1),m("profile_updated"),P(o.user.uid)};(e=>{d=e.startsWith("ar")?"ar":"en";let t="ar"===d?"rtl":"ltr";document.documentElement.lang=d,document.documentElement.dir=t,document.querySelectorAll("[data-translate-key]").forEach((e=>{e.textContent=c(e.dataset.translateKey)})),document.querySelectorAll("[data-translate-placeholder]").forEach((e=>{e.placeholder=c(e.dataset.translatePlaceholder)}))})(navigator.language||navigator.userLanguage),function(){a.onAuthStateChanged(D);let e=()=>{o.isAppMuted&&(o.isAppMuted=!1,m("audio_on",{},1500),s&&(s.muted=!1),document.body.removeEventListener("click",e),document.body.removeEventListener("touchstart",e))};document.body.addEventListener("click",e),document.body.addEventListener("touchstart",e),document.querySelectorAll(".nav-btn[data-page]").forEach((e=>{e.addEventListener("click",(()=>{let t=e.dataset.page;if(("profile-page"===t||"notifications-page"===t)&&!o.user)return h("loginModal");"profile-page"===t?P(o.user.uid):_(t)}))})),document.querySelectorAll("[data-modal-close]").forEach((e=>{e.addEventListener("click",(()=>g(e.dataset.modalClose)))})),u("newAvatarFile").addEventListener("change",(e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{u("avatarPreview").src=e.target.result},e.readAsDataURL(t)}})),u("mediaFileInput").addEventListener("change",(async e=>{let t=e.target.files?.[0],a=u("thumbnail-preview-container"),i=u("thumbnailPreviewImage");if(a.classList.add("hidden"),i.src="",n=null,t)if(t.type.startsWith("video/"))try{f(!0,"generating_thumbnail",0);let e=await((e,t,a)=>new Promise(((i,o)=>{let l=document.createElement("video"),s=document.createElement("canvas"),n=URL.createObjectURL(e);l.muted=!0,l.playsinline=!0,l.preload="metadata",l.crossOrigin="anonymous";let r=()=>{l.removeEventListener("seeked",d),l.removeEventListener("error",c),l.removeEventListener("loadedmetadata",u),URL.revokeObjectURL(n)},d=()=>{try{let{videoWidth:e,videoHeight:n}=l;e>n?e>t&&(n=Math.round(n*(t/e)),e=t):n>a&&(e=Math.round(e*(a/n)),n=a),s.width=e,s.height=n;let d=s.getContext("2d");if(!d)return r(),o(Error("Could not get canvas context."));d.drawImage(l,0,0,s.width,s.height),s.toBlob((e=>{r(),e?i(e):o(Error("Canvas to Blob conversion failed"))}),"image/jpeg",.8)}catch(e){r(),o(e)}},c=e=>{r(),o(Error("Video loading error"))},u=()=>{l.currentTime=1};l.addEventListener("loadedmetadata",u),l.addEventListener("seeked",d),l.addEventListener("error",c),l.src=n})))(t,512,512);n=e,i.src=URL.createObjectURL(e),a.classList.remove("hidden"),f(!1)}catch(e){console.error("Thumbnail generation failed:",e),m("upload_failed",{message:"Could not generate thumbnail."}),f(!1)}else t.type.startsWith("image/")&&(i.src=URL.createObjectURL(t),a.classList.remove("hidden"))})),document.body.addEventListener("click",(e=>{let l=e.target,s=l.closest("button"),r=l.closest(".media-item");if(!r||l.closest(".media-actions button")){if(s){switch(s.id){case"login-btn":a.signInWithEmailAndPassword(u("email").value,u("password").value).then((e=>{if(!e.user.emailVerified)return a.signOut(),void m("verify_email_alert",{},5e3);g("loginModal")})).catch((e=>m(e.message)));break;case"signup-btn":a.createUserWithEmailAndPassword(u("email").value,u("password").value).then((e=>{e.user.sendEmailVerification().then((()=>{m("verification_sent",{},6e3),a.signOut()})),t.ref("users/"+e.user.uid).set({email:e.user.email,displayName:e.user.email.split("@")[0],photoURL:"",bio:""}),g("loginModal")})).catch((e=>m(e.message)));break;case"google-login-btn":a.signInWithPopup(i).then((e=>{let a=e.user,i=t.ref("users/"+a.uid);i.once("value",(e=>{e.exists()||i.set({email:a.email,displayName:a.displayName,photoURL:a.photoURL,bio:""})})),g("loginModal")})).catch((e=>{console.error("Google Sign-In Error:",e);let t=e.code||"Error";"auth/unauthorized-domain"===e.code&&(t="google_auth_domain_error"),m(t,{},6e3)}));break;case"logout-btn":a.signOut(),m("logged_out");break;case"send-comment-btn":(()=>{if(!o.user)return h("loginModal");let e=u("comments-overlay").dataset.key,a=u("comment-input"),i=a.value.trim();if(!i||!e)return;let l=t.ref(`products/${e}`),s=l.child("comments").push().key;l.once("value",(l=>{let n=l.val();if(!n)return;let r={},d={user:o.user.uid,text:i,ts:firebase.database.ServerValue.TIMESTAMP};r[`/products/${e}/comments/${s}`]=d,n.uid!==o.user.uid&&(r[`/notifications/${t.ref("notifications").push().key}`]={from:o.user.displayName||o.user.email,fromId:o.user.uid,to:n.uid,type:"comment",postId:e,ts:firebase.database.ServerValue.TIMESTAMP}),r[`/products/${e}/engagementScore`]=firebase.database.ServerValue.increment(3),t.ref().update(r),a.value=""}))})();break;case"edit-profile-btn":(async()=>{if(!o.user)return;let e=await y(o.user.uid),t=e.photoURL||"https://img.icons8.com/ios/100/user.png";u("avatarPreview").src=t,u("newDisplayName").value=e.displayName||"",u("newBio").value=e.bio||"",u("newAvatarFile").value="",h("editProfileModal")})();break;case"saveProfileBtn":V();break;case"nav-upload-btn":N();break;case"save-upload-btn":(async()=>{if(!o.user)return h("loginModal");let e=u("uploadModal").dataset.editKey,a=u("mediaFileInput").files?.[0],i=u("type").value;if(!a&&!e)return m("file_required");g("uploadModal"),f(!0,"uploading",10);let l=e?await t.ref(`products/${e}`).once("value").then((e=>e.val())):{},s=l?.mediaUrl||null,r=l?.thumb||null;try{if(a)if("video"===i){f(!0,"generating_thumbnail",20);let e=n;if(!e)throw Error("Thumbnail not generated. Please re-select the file.");f(!0,"uploading_files",40);let t=`video_thumbnail_${o.user.uid}_${Date.now()}`,[i,l]=await Promise.all([b(a),b(e,{folder:"post_thumbnails",public_id:t})]);s=i,r=l}else f(!0,"uploading_image",40),r=s=await b(a)}catch(e){return console.error("Upload failed:",e),m("upload_failed",{message:e.message||"Unknown error"}),void f(!1)}f(!0,"saving_data",90);let d={title:u("title").value,desc:u("desc").value,type:i,mediaUrl:s,thumb:r,uid:o.user.uid,timestamp:firebase.database.ServerValue.TIMESTAMP,status:"pending",likes:l?.likes||0,views:l?.views||0,engagementScore:l?.engagementScore||0},c=e?t.ref("products/"+e):t.ref("products").push();await c.set(d),f(!1),m("upload_success"),u("profile-page").classList.contains("active")&&U(o.user.uid,!0)})();break;case"confirmDelete":o.deleteKey&&o.user&&t.ref("products/"+o.deleteKey).remove().then((()=>{m("deleted_successfully"),U(o.user.uid,!0)})),g("deleteToast"),o.deleteKey=null;break;case"cancelDelete":g("deleteToast"),o.deleteKey=null;break;case"sendChatBtn":(()=>{if(!o.user)return h("loginModal");let e=u("chatInput"),a=e.value.trim();if(!a||!o.currentChat.chatId)return;let i={},l=t.ref(`privateChats/${o.currentChat.chatId}/messages`).push().key,s={from:o.user.uid,to:o.currentChat.otherUid,text:a,ts:firebase.database.ServerValue.TIMESTAMP};i[`/privateChats/${o.currentChat.chatId}/messages/${l}`]=s;let n=t.ref("notifications").push().key,r={from:o.user.displayName||o.user.email,fromId:o.user.uid,to:o.currentChat.otherUid,type:"chat",ts:firebase.database.ServerValue.TIMESTAMP};i[`/notifications/${n}`]=r,t.ref().update(i),e.value=""})();break;case"privacy-policy-btn":_("privacy-page")}if(r&&s.dataset.action){e.stopPropagation();let a=r.dataset.key;"edit"===s.dataset.action?(e=>{t.ref("products/"+e).once("value",(t=>{t.exists()&&N(e,t.val())}))})(a):"delete"===s.dataset.action&&(e=>{o.deleteKey=e,h("deleteToast")})(a)}}}else I(r.dataset.key)})),document.body.addEventListener("click",(e=>{let t=u("comments-overlay");!t.classList.contains("show")||t.contains(e.target)||u("ui-comment-btn").contains(e.target)||S()}),!0),u("searchInput").addEventListener("input",B)}()}))</script>
<script type=module src=/index.tsx></script>
</body>
</html>
